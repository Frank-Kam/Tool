<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR / 條碼 / Wi-Fi 產生器</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.4.4/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.12.1/JsBarcode.all.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #qrcodeCanvas {
      width: 100%;
      height: auto;
    }
    #barcodeSvg {
      max-width: 100%;
      height: auto;
    }
    button {
      min-height: 48px;
    }
    body {
      overscroll-behavior: none;
    }
  </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 min-h-screen">
  <div class="max-w-xl mx-auto bg-white p-4 sm:p-6 rounded-xl shadow">
    <h1 class="text-xl sm:text-2xl font-bold mb-4">QR / 條碼 / Wi-Fi 產生器</h1>

    <label class="block mb-2 font-medium">選擇類型：</label>
    <select id="codeType" class="w-full border p-2 rounded mb-4 text-sm sm:text-base">
      <option value="qrcode">QR Code</option>
      <option value="wifi">Wi-Fi QR Code</option>
      <option value="barcode">條碼</option>
    </select>

    <!-- 通用輸入區 -->
    <div id="commonInputSection" class="mb-4">
      <label class="block mb-2 font-medium">輸入資料：</label>
      <input id="inputText" type="text" class="w-full border p-2 rounded text-sm sm:text-base" placeholder="輸入文字、數字、網址等">
    </div>

    <!-- QR Code 大小選擇 -->
    <div id="qrSizeContainer" class="mb-4">
      <label class="block mb-2 font-medium">圖片畫質：</label>
      <select id="qrSize" class="w-full border p-2 rounded text-sm sm:text-base">
        <option value="256">256px（預設）</option>
        <option value="128">128px</option>
        <option value="512">512px</option>
        <option value="1024">1024px</option>
        <option value="2048">2048px</option>
        <option value="4096">4096px</option>
      </select>
    </div>

    <!-- 條碼選項 -->
    <div id="barcodeTypeContainer" class="mb-4 hidden">
      <label class="block mb-2 font-medium">條碼編碼：</label>
      <select id="barcodeFormat" class="w-full border p-2 rounded text-sm sm:text-base">
        <option value="CODE128">CODE128</option>
        <option value="EAN13">EAN13</option>
        <option value="UPC">UPC</option>
      </select>
    </div>

    <!-- Wi-Fi 專用輸入區 -->
    <div id="wifiInputSection" class="hidden mb-4 space-y-2">
      <label class="block font-medium">Wi-Fi 名稱 (SSID)：</label>
      <input id="wifiSSID" type="text" class="w-full border p-2 rounded text-sm sm:text-base">

      <label class="block font-medium">密碼：</label>
      <input id="wifiPassword" type="text" class="w-full border p-2 rounded text-sm sm:text-base">

      <label class="block font-medium">加密類型：</label>
      <select id="wifiType" class="w-full border p-2 rounded text-sm sm:text-base">
        <option value="WPA">WPA/WPA2</option>
        <option value="WEP">WEP</option>
        <option value="nopass">無密碼</option>
      </select>

      <label class="inline-flex items-center mt-2">
        <input id="wifiHidden" type="checkbox" class="mr-2"> 隱藏 SSID
      </label>
    </div>

    <button onclick="generateCode()" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 mt-2 text-sm sm:text-base">產生</button>

    <div id="errorMessage" class="text-red-500 text-center mt-2 hidden"></div>

    <div class="mt-6 text-center">
      <canvas id="qrcodeCanvas" class="mx-auto hidden"></canvas>
      <svg id="barcodeSvg" class="mx-auto hidden"></svg>
    </div>

    <div id="downloadSection" class="mt-4 text-center hidden">
      <a id="downloadLink" class="text-blue-600 hover:underline">下載圖片</a>
    </div>
  </div>

  <script>
    const codeType = document.getElementById('codeType');
    const commonInputSection = document.getElementById('commonInputSection');
    const barcodeTypeContainer = document.getElementById('barcodeTypeContainer');
    const wifiInputSection = document.getElementById('wifiInputSection');
    const qrSizeContainer = document.getElementById('qrSizeContainer');
    const errorMessage = document.getElementById('errorMessage');
    const downloadSection = document.getElementById('downloadSection');
    const downloadLink = document.getElementById('downloadLink');

    codeType.addEventListener('change', () => {
      const type = codeType.value;
      commonInputSection.classList.toggle('hidden', type === 'wifi');
      barcodeTypeContainer.classList.toggle('hidden', type !== 'barcode');
      wifiInputSection.classList.toggle('hidden', type !== 'wifi');
      qrSizeContainer.classList.toggle('hidden', type === 'barcode');
      errorMessage.classList.add('hidden');
      downloadSection.classList.add('hidden');
    });

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove('hidden');
    }

    function generateCode() {
      const type = codeType.value;
      const canvas = document.getElementById('qrcodeCanvas');
      const barcodeSvg = document.getElementById('barcodeSvg');
      canvas.classList.add('hidden');
      barcodeSvg.classList.add('hidden');
      errorMessage.classList.add('hidden');
      downloadSection.classList.add('hidden');

      if (type === 'qrcode') {
        const text = document.getElementById('inputText').value;
        const size = parseInt(document.getElementById('qrSize').value);
        if (!text) {
          showError('請輸入資料！');
          return;
        }
        QRCode.toCanvas(canvas, text, { width: size }, function (error) {
          if (error) {
            showError('生成 QR Code 失敗！');
            console.error(error);
            return;
          }
          // 確保顯示時縮放而不變形
          canvas.style.width = '100%';
          canvas.style.height = 'auto';

          canvas.classList.remove('hidden');
          downloadLink.href = canvas.toDataURL('image/png');
          downloadLink.download = 'qrcode.png';
          downloadSection.classList.remove('hidden');
        });
      } else if (type === 'barcode') {
        const text = document.getElementById('inputText').value;
        const format = document.getElementById('barcodeFormat').value;
        if (!text) {
          showError('請輸入資料！');
          return;
        }
        try {
          JsBarcode("#barcodeSvg", text, {
            format: format,
            displayValue: true,
            width: 2,
            height: 100,
            fontSize: 18
          });
          barcodeSvg.classList.remove('hidden');
          const svgData = new XMLSerializer().serializeToString(barcodeSvg);
          const blob = new Blob([svgData], { type: 'image/svg+xml' });
          downloadLink.href = URL.createObjectURL(blob);
          downloadLink.download = 'barcode.svg';
          downloadSection.classList.remove('hidden');
        } catch (error) {
          showError('生成條碼失敗，請檢查輸入格式！');
          console.error(error);
        }
      } else if (type === 'wifi') {
        const ssid = document.getElementById('wifiSSID').value;
        const pwd = document.getElementById('wifiPassword').value;
        const enc = document.getElementById('wifiType').value;
        const size = parseInt(document.getElementById('qrSize').value);
        if (!ssid) {
          showError('請輸入 Wi-Fi 名稱 (SSID)！');
          return;
        }
        if (enc !== 'nopass' && !pwd) {
          showError('請輸入 Wi-Fi 密碼！');
          return;
        }
        const hidden = document.getElementById('wifiHidden').checked ? 'H:true;' : '';
        const wifiData = `WIFI:T:${enc};S:${ssid};P:${pwd};${hidden};`;
        QRCode.toCanvas(canvas, wifiData, { width: size }, function (error) {
          if (error) {
            showError('生成 Wi-Fi QR Code 失敗！');
            console.error(error);
            return;
          }
          canvas.style.width = '100%';
          canvas.style.height = 'auto';

          canvas.classList.remove('hidden');
          downloadLink.href = canvas.toDataURL('image/png');
          downloadLink.download = 'wifi-qrcode.png';
          downloadSection.classList.remove('hidden');
        });
      }
    }
  </script>
</body>
</html>